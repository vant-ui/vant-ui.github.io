import{G as j,n as q,c as J,s as _,l as K,h as O}from"./use-translate-982dff2e.js";import{u as Q}from"./use-refs-4e2d69f7.js";import{u as W}from"./use-touch-87b155f0.js";import{I as A}from"./index-e4434a2e.js";import{A as Z,y as $,D as x,e as f}from"./vue-libs-6a67f9c6.js";import{n as B,m as F,c as ee,t as te,a as oe,w as ae}from"./with-install-3eab31d5.js";const[le,m]=J("rate");function se(t,s,n,r){return t>=s?{status:"full",value:1}:t+.5>=s&&n&&!r?{status:"half",value:.5}:t+1>=s&&n&&r?{status:"half",value:Math.round((t-s+1)*1e10)/1e10}:{status:"void",value:0}}const ne={size:B,icon:F("star"),color:String,count:ee(5),gutter:B,readonly:Boolean,disabled:Boolean,voidIcon:F("star-o"),allowHalf:Boolean,voidColor:String,touchable:te,iconPrefix:String,modelValue:oe(0),disabledColor:String},ie=Z({name:le,props:ne,emits:["change","update:modelValue"],setup(t,{emit:s}){const n=W(),[r,p]=Q(),h=$(),P=()=>t.readonly||t.disabled||!t.touchable,G=x(()=>Array(+t.count).fill("").map((o,e)=>se(t.modelValue,e+1,t.allowHalf,t.readonly)));let l,c,g=Number.MAX_SAFE_INTEGER,b=Number.MIN_SAFE_INTEGER;const S=()=>{c=_(h);const o=r.value.map(_);l=[],o.forEach((e,a)=>{g=Math.min(e.top,g),b=Math.max(e.top,b),t.allowHalf?l.push({score:a+.5,left:e.left,top:e.top,height:e.height},{score:a+1,left:e.left+e.width/2,top:e.top,height:e.height}):l.push({score:a+1,left:e.left,top:e.top,height:e.height})})},V=(o,e)=>{for(let a=l.length-1;a>0;a--)if(e>=c.top&&e<=c.bottom){if(o>l[a].left&&e>=l[a].top&&e<=l[a].top+l[a].height)return l[a].score}else{const u=e<c.top?g:b;if(o>l[a].left&&l[a].top===u)return l[a].score}return t.allowHalf?.5:1},y=o=>{!t.disabled&&!t.readonly&&o!==t.modelValue&&(s("update:modelValue",o),s("change",o))},X=o=>{P()||(n.start(o),S())},D=o=>{if(!P()&&(n.move(o),n.isHorizontal())){const{clientX:e,clientY:a}=o.touches[0];K(o),y(V(e,a))}},Y=(o,e)=>{const{icon:a,size:u,color:I,count:N,gutter:T,voidIcon:w,disabled:i,voidColor:C,allowHalf:E,iconPrefix:k,disabledColor:z}=t,v=e+1,R=o.status==="full",d=o.status==="void",L=E&&o.value>0&&o.value<1;let H;T&&v!==+N&&(H={paddingRight:O(T)});const U=M=>{S(),y(E?V(M.clientX,M.clientY):v)};return f("div",{key:e,ref:p(e),role:"radio",style:H,class:m("item"),tabindex:i?void 0:0,"aria-setsize":N,"aria-posinset":v,"aria-checked":!d,onClick:U},[f(A,{size:u,name:R?a:w,class:m("icon",{disabled:i,full:R}),color:i?z:R?I:C,classPrefix:k},null),L&&f(A,{size:u,style:{width:o.value+"em"},name:d?w:a,class:m("icon",["half",{disabled:i,full:!d}]),color:i?z:d?C:I,classPrefix:k},null)])};return j(()=>t.modelValue),q("touchmove",D,{target:h}),()=>f("div",{ref:h,role:"radiogroup",class:m({readonly:t.readonly,disabled:t.disabled}),tabindex:t.disabled?void 0:0,"aria-disabled":t.disabled,"aria-readonly":t.readonly,onTouchstartPassive:X},[G.value.map(Y)])}}),re=ae(ie),ge=re;export{ge as V};
