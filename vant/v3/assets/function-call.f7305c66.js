import{c as F,n as oe,l as A,F as S,N as te,R as ae,p as se,r as ne,d as ie,e as ce}from"./use-translate.d2900b8c.js";import{d as H,n as $,t as Z,b as le,c as z,u as E,m as O,w as re}from"./with-install.19a35764.js";import{m as me,u as ue}from"./mount-component.f3744995.js";import{H as de}from"./constant.80c6de18.js";import{c as ve}from"./interceptor.f0c85874.js";import{u as ge}from"./use-expose.c942d5f8.js";import{I as fe}from"./index.b70c9b40.js";import{a as he,S as we}from"./index.1461a543.js";import{P as pe}from"./index.e6e790ed.js";import{u as Pe}from"./use-touch.04ca7093.js";import{I as Ie}from"./index.45d743b7.js";import{L as xe}from"./index.4e4daaac.js";import{z as L,H as _,C as j,D as T,u as b,e as r,N as Ce,q as ye,Q as Se,A as q}from"./vue-libs.b44bc779.js";const B=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),W=F("image-preview")[1],Te=L({props:{src:String,show:Boolean,active:Number,minZoom:H($),maxZoom:H($),rootWidth:H(Number),rootHeight:H(Number)},emits:["scale","close"],setup(e,{emit:c,slots:m}){const o=_({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),n=Pe(),h=j(),x=T(()=>{const{rootWidth:t,rootHeight:s}=e,i=s/t;return o.imageRatio>i}),X=T(()=>{const{scale:t,moveX:s,moveY:i,moving:v,zooming:P}=o,Y={transitionDuration:P||v?"0s":".3s"};if(t!==1){const J=s/t,ee=i/t;Y.transform=`scale(${t}, ${t}) translate(${J}px, ${ee}px)`}return Y}),g=T(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:s}=e,i=x.value?s/o.imageRatio:t;return Math.max(0,(o.scale*i-t)/2)}return 0}),u=T(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:s}=e,i=x.value?s:t*o.imageRatio;return Math.max(0,(o.scale*i-s)/2)}return 0}),C=t=>{t=S(t,+e.minZoom,+e.maxZoom+1),t!==o.scale&&(o.scale=t,c("scale",{scale:t,index:e.active}))},y=()=>{C(1),o.moveX=0,o.moveY=0},R=()=>{const t=o.scale>1?1:2;C(t),o.moveX=0,o.moveY=0};let w,p,f,a,d,l,M;const U=t=>{const{touches:s}=t,{offsetX:i}=n;n.start(t),w=s.length,p=o.moveX,f=o.moveY,M=Date.now(),o.moving=w===1&&o.scale!==1,o.zooming=w===2&&!i.value,o.zooming&&(a=o.scale,d=B(t.touches))},K=t=>{const{touches:s}=t;if(n.move(t),(o.moving||o.zooming)&&A(t,!0),o.moving){const{deltaX:i,deltaY:v}=n,P=i.value+p,Y=v.value+f;o.moveX=S(P,-g.value,g.value),o.moveY=S(Y,-u.value,u.value)}if(o.zooming&&s.length===2){const i=B(s),v=a*i/d;C(v)}},Q=()=>{if(w>1)return;const{offsetX:t,offsetY:s}=n,i=Date.now()-M,v=250,P=5;t.value<P&&s.value<P&&i<v&&(l?(clearTimeout(l),l=null,R()):l=setTimeout(()=>{c("close"),l=null},v))},k=t=>{let s=!1;(o.moving||o.zooming)&&(s=!0,o.moving&&p===o.moveX&&f===o.moveY&&(s=!1),t.touches.length||(o.zooming&&(o.moveX=S(o.moveX,-g.value,g.value),o.moveY=S(o.moveY,-u.value,u.value),o.zooming=!1),o.moving=!1,p=0,f=0,a=1,o.scale<1&&y(),o.scale>e.maxZoom&&(o.scale=+e.maxZoom))),A(t,s),Q(),n.reset()},G=t=>{const{naturalWidth:s,naturalHeight:i}=t.target;o.imageRatio=i/s};return b(()=>e.active,y),b(()=>e.show,t=>{t||y()}),oe("touchmove",K,{target:T(()=>{var t;return(t=h.value)==null?void 0:t.$el})}),()=>{const t={loading:()=>r(xe,{type:"spinner"},null)};return r(he,{ref:h,class:W("swipe-item"),onTouchstartPassive:U,onTouchend:k,onTouchcancel:k},{default:()=>[m.image?r("div",{class:W("image-wrap")},[m.image({src:e.src})]):r(Ie,{src:e.src,fit:"contain",class:W("image",{vertical:x.value}),style:X.value,onLoad:G},t)]})}}});function be(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Se(e)}const[Xe,I]=F("image-preview"),Ye=["show","transition","overlayStyle","closeOnPopstate"],He={show:Boolean,loop:Z,images:le(),minZoom:z(1/3),maxZoom:z(3),overlay:Z,closeable:Boolean,showIndex:Z,className:E,closeIcon:O("clear"),transition:String,beforeClose:Function,overlayClass:E,overlayStyle:Object,swipeDuration:z(300),startPosition:z(0),showIndicators:Boolean,closeOnPopstate:Z,closeIconPosition:O("top-right")},V=L({name:Xe,props:He,emits:["scale","close","closed","change","update:show"],setup(e,{emit:c,slots:m}){const o=j(),n=_({active:0,rootWidth:0,rootHeight:0}),h=()=>{if(o.value){const a=ne(o.value.$el);n.rootWidth=a.width,n.rootHeight=a.height,o.value.resize()}},x=a=>c("scale",a),X=a=>c("update:show",a),g=()=>{ve(e.beforeClose,{args:[n.active],done:()=>X(!1)})},u=a=>{a!==n.active&&(n.active=a,c("change",a))},C=()=>{if(e.showIndex)return r("div",{class:I("index")},[m.index?m.index({index:n.active}):`${n.active+1} / ${e.images.length}`])},y=()=>{if(m.cover)return r("div",{class:I("cover")},[m.cover()])},R=()=>{let a;return r(we,{ref:o,lazyRender:!0,loop:e.loop,class:I("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:u},be(a=e.images.map(d=>r(Te,{src:d,show:e.show,active:n.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:n.rootWidth,rootHeight:n.rootHeight,onScale:x,onClose:g},{image:m.image})))?a:{default:()=>[a]})},w=()=>{if(e.closeable)return r(fe,{role:"button",name:e.closeIcon,class:[I("close-icon",e.closeIconPosition),de],onClick:g},null)},p=()=>c("closed"),f=(a,d)=>{var l;return(l=o.value)==null?void 0:l.swipeTo(a,d)};return ge({swipeTo:f}),Ce(h),b([te,ae],h),b(()=>e.startPosition,a=>u(+a)),b(()=>e.show,a=>{const{images:d,startPosition:l}=e;a?(u(+l),ye(()=>{h(),f(+l,{immediate:!0})})):c("close",{index:n.active,url:d[n.active]})}),()=>r(pe,q({class:[I(),e.className],overlayClass:[I("overlay"),e.overlayClass],onClosed:p,"onUpdate:show":X},se(e,Ye)),{default:()=>[w(),R(),C(),y()]})}});let N;const Ze={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function ze(){({instance:N}=me({setup(){const{state:e,toggle:c}=ue(),m=()=>{e.images=[]};return()=>r(V,q(e,{onClosed:m,"onUpdate:show":c}),null)}}))}const D=(e,c=0)=>{if(!!ie)return N||ze(),e=Array.isArray(e)?{images:e,startPosition:c}:e,N.open(ce({},Ze,e)),N};D.Component=re(V);D.install=e=>{e.use(D.Component)};export{D as I};
