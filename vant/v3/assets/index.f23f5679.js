import{c as K,H as me,h as he,p as U,r as ee,I as ge,o as ye,J as te,K as Z,L as ve}from"./use-translate.d2900b8c.js";import{d as q,a as De,n as ne,m as se,t as H,c as we,w as be}from"./with-install.19a35764.js";import{u as ke}from"./use-refs.b3168e03.js";import{u as fe}from"./use-expose.c942d5f8.js";import{P as Se}from"./index.e6e790ed.js";import{B as Te}from"./index.8e37fe56.js";import{T as ce}from"./function-call.509e41a7.js";import{g as Me}from"./utils.7f5ee97d.js";import{u as xe}from"./use-height.f6deaa0a.js";import{z as _,D as x,e as c,C as z,u as p,A as Re}from"./vue-libs.b44bc779.js";const[Ce,f,W]=K("calendar"),Oe=e=>W("monthTitle",e.getFullYear(),e.getMonth()+1);function ae(e,s){const i=e.getFullYear(),d=s.getFullYear();if(i===d){const w=e.getMonth(),M=s.getMonth();return w===M?0:w>M?1:-1}return i>d?1:-1}function R(e,s){const i=ae(e,s);if(i===0){const d=e.getDate(),w=s.getDate();return d===w?0:d>w?1:-1}return i}const J=e=>new Date(e),ue=e=>Array.isArray(e)?e.map(J):J(e);function le(e,s){const i=J(e);return i.setDate(i.getDate()+s),i}const oe=e=>le(e,-1),de=e=>le(e,1),re=()=>{const e=new Date;return e.setHours(0,0,0,0),e};function Pe(e){const s=e[0].getTime();return(e[1].getTime()-s)/(1e3*60*60*24)+1}const[Ae]=K("calendar-day"),Be=_({name:Ae,props:{item:q(Object),color:String,index:Number,offset:De(0),rowHeight:String},emits:["click"],setup(e,{emit:s,slots:i}){const d=x(()=>{var N;const{item:a,index:g,color:k,offset:I,rowHeight:O}=e,S={height:O};if(a.type==="placeholder")return S.width="100%",S;if(g===0&&(S.marginLeft=`${100*I/7}%`),k)switch(a.type){case"end":case"start":case"start-end":case"multiple-middle":case"multiple-selected":S.background=k;break;case"middle":S.color=k;break}return I+(((N=a.date)==null?void 0:N.getDate())||1)>28&&(S.marginBottom=0),S}),w=()=>{e.item.type!=="disabled"&&s("click",e.item)},M=()=>{const{topInfo:a}=e.item;if(a||i["top-info"])return c("div",{class:f("top-info")},[i["top-info"]?i["top-info"](e.item):a])},C=()=>{const{bottomInfo:a}=e.item;if(a||i["bottom-info"])return c("div",{class:f("bottom-info")},[i["bottom-info"]?i["bottom-info"](e.item):a])},b=()=>{const{item:a,color:g,rowHeight:k}=e,{type:I,text:O}=a,S=[M(),O,C()];return I==="selected"?c("div",{class:f("selected-day"),style:{width:k,height:k,background:g}},[S]):S};return()=>{const{type:a,className:g}=e.item;return a==="placeholder"?c("div",{class:f("day"),style:d.value},null):c("div",{role:"gridcell",style:d.value,class:[f("day",a),g],tabindex:a==="disabled"?void 0:-1,onClick:w},[b()])}}}),[He]=K("calendar-month"),Ie={date:q(Date),type:String,color:String,minDate:q(Date),maxDate:q(Date),showMark:Boolean,rowHeight:ne,formatter:Function,lazyRender:Boolean,currentDate:[Date,Array],allowSameDay:Boolean,showSubtitle:Boolean,showMonthTitle:Boolean,firstDayOfWeek:Number},We=_({name:He,props:Ie,emits:["click","update-height"],setup(e,{emit:s,slots:i}){const[d,w]=me(),M=z(),C=z(),b=xe(C),a=x(()=>Oe(e.date)),g=x(()=>he(e.rowHeight)),k=x(()=>{const o=e.date.getDay();return e.firstDayOfWeek?(o+7-e.firstDayOfWeek)%7:o}),I=x(()=>Me(e.date.getFullYear(),e.date.getMonth()+1)),O=x(()=>d.value||!e.lazyRender),S=()=>a.value,N=o=>{const m=y=>e.currentDate.some(u=>R(u,y)===0);if(m(o)){const y=oe(o),u=de(o),v=m(y),t=m(u);return v&&t?"multiple-middle":v?"end":t?"start":"multiple-selected"}return""},F=o=>{const[m,y]=e.currentDate;if(!m)return"";const u=R(o,m);if(!y)return u===0?"start":"";const v=R(o,y);return e.allowSameDay&&u===0&&v===0?"start-end":u===0?"start":v===0?"end":u>0&&v<0?"middle":""},V=o=>{const{type:m,minDate:y,maxDate:u,currentDate:v}=e;if(R(o,y)<0||R(o,u)>0)return"disabled";if(v===null)return"";if(Array.isArray(v)){if(m==="multiple")return N(o);if(m==="range")return F(o)}else if(m==="single")return R(o,v)===0?"selected":"";return""},Y=o=>{if(e.type==="range"){if(o==="start"||o==="end")return W(o);if(o==="start-end")return`${W("start")}/${W("end")}`}},E=()=>{if(e.showMonthTitle)return c("div",{class:f("month-title")},[a.value])},j=()=>{if(e.showMark&&O.value)return c("div",{class:f("month-mark")},[e.date.getMonth()+1])},L=x(()=>{const o=Math.ceil((I.value+k.value)/7);return Array(o).fill({type:"placeholder"})}),$=x(()=>{const o=[],m=e.date.getFullYear(),y=e.date.getMonth();for(let u=1;u<=I.value;u++){const v=new Date(m,y,u),t=V(v);let n={date:v,type:t,text:u,bottomInfo:Y(t)};e.formatter&&(n=e.formatter(n)),o.push(n)}return o}),P=x(()=>$.value.filter(o=>o.type==="disabled")),G=(o,m)=>{if(M.value){const y=ee(M.value),u=L.value.length,t=(Math.ceil((m.getDate()+k.value)/7)-1)*y.height/u;ge(o,y.top+t+o.scrollTop-ee(o).top)}},Q=(o,m)=>c(Be,{item:o,index:m,color:e.color,offset:k.value,rowHeight:g.value,onClick:y=>s("click",y)},U(i,["top-info","bottom-info"])),X=()=>c("div",{ref:M,role:"grid",class:f("days")},[j(),(O.value?$:L).value.map(Q)]);return fe({getTitle:S,getHeight:()=>b.value,setVisible:w,scrollToDate:G,disabledDays:P}),()=>c("div",{class:f("month"),ref:C},[E(),X()])}}),[Ne]=K("calendar-header"),Fe=_({name:Ne,props:{title:String,subtitle:String,showTitle:Boolean,showSubtitle:Boolean,firstDayOfWeek:Number},emits:["click-subtitle"],setup(e,{slots:s,emit:i}){const d=()=>{if(e.showTitle){const b=e.title||W("title"),a=s.title?s.title():b;return c("div",{class:f("header-title")},[a])}},w=b=>i("click-subtitle",b),M=()=>{if(e.showSubtitle){const b=s.subtitle?s.subtitle():e.subtitle;return c("div",{class:f("header-subtitle"),onClick:w},[b])}},C=()=>{const{firstDayOfWeek:b}=e,a=W("weekdays"),g=[...a.slice(b,7),...a.slice(0,b)];return c("div",{class:f("weekdays")},[g.map(k=>c("span",{class:f("weekday")},[k]))])};return()=>c("div",{class:f("header")},[d(),M(),C()])}}),Ye={show:Boolean,type:se("single"),title:String,color:String,round:H,readonly:Boolean,poppable:H,maxRange:we(null),position:se("bottom"),teleport:[String,Object],showMark:H,showTitle:H,formatter:Function,rowHeight:ne,confirmText:String,rangePrompt:String,lazyRender:H,showConfirm:H,defaultDate:[Date,Array],allowSameDay:Boolean,showSubtitle:H,closeOnPopstate:H,showRangePrompt:H,confirmDisabledText:String,closeOnClickOverlay:H,safeAreaInsetTop:Boolean,safeAreaInsetBottom:H,minDate:{type:Date,validator:te,default:re},maxDate:{type:Date,validator:te,default:()=>{const e=re();return new Date(e.getFullYear(),e.getMonth()+6,e.getDate())}},firstDayOfWeek:{type:ne,default:0,validator:e=>e>=0&&e<=6}},$e=_({name:Ce,props:Ye,emits:["select","confirm","unselect","month-show","over-range","update:show","click-subtitle"],setup(e,{emit:s,slots:i}){const d=(t,n=e.minDate,r=e.maxDate)=>R(t,n)===-1?n:R(t,r)===1?r:t,w=(t=e.defaultDate)=>{const{type:n,minDate:r,maxDate:l,allowSameDay:T}=e;if(t===null)return t;const D=re();if(n==="range"){Array.isArray(t)||(t=[]);const A=d(t[0]||D,r,T?l:oe(l)),h=d(t[1]||D,T?r:de(r));return[A,h]}return n==="multiple"?Array.isArray(t)?t.map(A=>d(A)):[d(D)]:((!t||Array.isArray(t))&&(t=D),d(t))};let M;const C=z(),b=z(""),a=z(w()),[g,k]=ke(),I=x(()=>e.firstDayOfWeek?+e.firstDayOfWeek%7:0),O=x(()=>{const t=[],n=new Date(e.minDate);n.setDate(1);do t.push(new Date(n)),n.setMonth(n.getMonth()+1);while(ae(n,e.maxDate)!==1);return t}),S=x(()=>{if(a.value){if(e.type==="range")return!a.value[0]||!a.value[1];if(e.type==="multiple")return!a.value.length}return!a.value}),N=()=>a.value,F=()=>{const t=ve(C.value),n=t+M,r=O.value.map((h,B)=>g.value[B].getHeight()),l=r.reduce((h,B)=>h+B,0);if(n>l&&t>0)return;let T=0,D;const A=[-1,-1];for(let h=0;h<O.value.length;h++){const B=g.value[h];T<=n&&T+r[h]>=t&&(A[1]=h,D||(D=B,A[0]=h),g.value[h].showed||(g.value[h].showed=!0,s("month-show",{date:B.date,title:B.getTitle()}))),T+=r[h]}O.value.forEach((h,B)=>{const ie=B>=A[0]-1&&B<=A[1]+1;g.value[B].setVisible(ie)}),D&&(b.value=D.getTitle())},V=t=>{Z(()=>{O.value.some((n,r)=>ae(n,t)===0?(C.value&&g.value[r].scrollToDate(C.value,t),!0):!1),F()})},Y=()=>{if(!(e.poppable&&!e.show))if(a.value){const t=e.type==="single"?a.value:a.value[0];te(t)&&V(t)}else Z(F)},E=()=>{e.poppable&&!e.show||(Z(()=>{M=Math.floor(ee(C).height)}),Y())},j=(t=w())=>{a.value=t,Y()},L=t=>{const{maxRange:n,rangePrompt:r,showRangePrompt:l}=e;return n&&Pe(t)>n?(l&&ce(r||W("rangePrompt",n)),s("over-range"),!1):!0},$=()=>{var t;return s("confirm",(t=a.value)!=null?t:ue(a.value))},P=(t,n)=>{const r=l=>{a.value=l,s("select",ue(l))};if(n&&e.type==="range"&&!L(t)){r([t[0],le(t[0],+e.maxRange-1)]);return}r(t),n&&!e.showConfirm&&$()},G=(t,n,r)=>{var l;return(l=t.find(T=>R(n,T.date)===-1&&R(T.date,r)===-1))==null?void 0:l.date},Q=x(()=>g.value.reduce((t,n)=>{var r,l;return t.push(...(l=(r=n.disabledDays)==null?void 0:r.value)!=null?l:[]),t},[])),X=t=>{if(e.readonly||!t.date)return;const{date:n}=t,{type:r}=e;if(r==="range"){if(!a.value){P([n]);return}const[l,T]=a.value;if(l&&!T){const D=R(n,l);if(D===1){const A=G(Q.value,l,n);if(A){const h=oe(A);R(l,h)===-1?P([l,h]):P([n])}else P([l,n],!0)}else D===-1?P([n]):e.allowSameDay&&P([n,n],!0)}else P([n])}else if(r==="multiple"){if(!a.value){P([n]);return}const l=a.value,T=l.findIndex(D=>R(D,n)===0);if(T!==-1){const[D]=l.splice(T,1);s("unselect",J(D))}else e.maxRange&&l.length>=e.maxRange?ce(e.rangePrompt||W("rangePrompt",e.maxRange)):P([...l,n])}else P(n,!0)},o=t=>s("update:show",t),m=(t,n)=>{const r=n!==0||!e.showSubtitle;return c(We,Re({ref:k(n),date:t,currentDate:a.value,showMonthTitle:r,firstDayOfWeek:I.value},U(e,["type","color","minDate","maxDate","showMark","formatter","rowHeight","lazyRender","showSubtitle","allowSameDay"]),{onClick:X}),U(i,["top-info","bottom-info"]))},y=()=>{if(i.footer)return i.footer();if(e.showConfirm){const t=i["confirm-text"],n=S.value,r=n?e.confirmDisabledText:e.confirmText;return c(Te,{round:!0,block:!0,type:"danger",color:e.color,class:f("confirm"),disabled:n,nativeType:"button",onClick:$},{default:()=>[t?t({disabled:n}):r||W("confirm")]})}},u=()=>c("div",{class:[f("footer"),{"van-safe-area-bottom":e.safeAreaInsetBottom}]},[y()]),v=()=>c("div",{class:f()},[c(Fe,{title:e.title,subtitle:b.value,showTitle:e.showTitle,showSubtitle:e.showSubtitle,firstDayOfWeek:I.value,"onClick-subtitle":t=>s("click-subtitle",t)},U(i,["title","subtitle"])),c("div",{ref:C,class:f("body"),onScroll:F},[O.value.map(m)]),u()]);return p(()=>e.show,E),p(()=>[e.type,e.minDate,e.maxDate],()=>j(w(a.value))),p(()=>e.defaultDate,(t=null)=>{a.value=t,Y()}),fe({reset:j,scrollToDate:V,getSelectedDate:N}),ye(E),()=>e.poppable?c(Se,{show:e.show,class:f("popup"),round:e.round,position:e.position,closeable:e.showTitle||e.showSubtitle,teleport:e.teleport,closeOnPopstate:e.closeOnPopstate,safeAreaInsetTop:e.safeAreaInsetTop,closeOnClickOverlay:e.closeOnClickOverlay,"onUpdate:show":o},{default:v}):v()}}),ze=be($e),Qe=ze;export{Qe as V};
